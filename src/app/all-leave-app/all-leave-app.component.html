
<ul class="nav nav-tabs nav-justified md-tabs deep-purple" id="myTabJust" role="tablist" *ngIf="currentUser.userRole=='admin' || currentUser.userRole=='projectManager'">
  <li class="nav-item">
    <!-- <img src="assets/icons/pending.png"> -->
    <a class="nav-link" (click)="leavesToDisplay=false; selectedStatus='pending'; getFilteredLeaves()">Pending Leaves</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" (click)="leavesToDisplay=false; selectedStatus='approved'; getFilteredLeaves()">Accepted Leaves</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" (click)="leavesToDisplay=false; selectedStatus='rejected'; getFilteredLeaves()">Rejected Leaves</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" (click)="leavesToDisplay=false">
      <div>
        <select class="browser-default custom-select custom-select-lg  text-left" *ngIf="developers && currentUser.userRole=='projectManager'" (change)="filterTracks(trackChangeDeveloperWise = $event.target.value)">
          <option value="all" selected>All Developer</option>
          <option *ngFor="let developer of developers" value="{{developer.email}}">{{developer.name}}</option>
        </select>
      </div>
    </a>
  </li>
</ul>


<div class="row justify-content-center" *ngIf="!leavesToDisplay">
  <div class="col-12 col-md-12">
    <div class="card card-cascade narrower" *ngIf="currentUser.userRole=='projectManager' || currentUser.userRole=='admin' ">
      <div class="view view-cascade purple-gradient-2 color-block narrower  d-flex justify-content-between align-items-center">
        <h2 class="white-text mx-3" style=" margin: 0; padding: 10px 0;
        max-width: calc(100% - 130px)
        ;">Leave Applications</h2>
        <div>
          <div class="btn-group dropleft  px-2 py-2 ">
            <button type="button" class="btn btn-outline-white btn-rounded btn-sm px-2" data-toggle="dropdown" style="border-radius: 48%;" >
              <i class="fas fa-search mt-0"></i>
            </button>
            <div class="dropdown-menu">
              <div class="md-form form-group active">
                <i class="fas fa-search prefix"></i>
                <input type="text" id="exampleForm2" class="form-control " [(ngModel)]="searchText" (keyup)="onKey(searchText)" autocomplete="off">
                <label for="exampleForm2" >Search</label>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-outline-white btn-rounded btn-sm px-2" (click)="sortLeavesByFromDate('asc')">
            <i class="fas fa-caret-up mt-0"></i>
          </button>
          <button type="button" class="btn btn-outline-white btn-rounded btn-sm px-2" (click)="sortLeavesByFromDate('desc')">
            <i class="fas fa-caret-down mt-0"></i>
          </button>
        </div>
      </div>
      <div class="px-4" style="text-align: center;">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>
                  Avtar
                </th>
                <th>
                  <span>Name
                  </span>
                </th> 
                <th>
                  <span>Leave-Duration
                  </span>
                </th>
                <th>
                  <span>Attachment</span>
                </th>
                <th>
                  <span>Comment</span>
                </th>
                <th>
                  <span>ViewMore</span>
                </th>
                <th>
                  <span>Leave-Status</span>
                  <!-- <i class="fas fa-sort ml-1"></i> -->
                </th>
                <th id="statusAction">
                  <span>Action</span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leaves of leaveApp">
                <td style="width: 56px;">
                  <div class="avatar mx-auto" *ngIf= "leaves.dev">
                    <a routerLink = "/visit-user-profile/{{leaves.dev._id}}">
                      <img src="{{path}}{{leaves.dev.profilePhoto}}" onerror="this.src='../assets/man.png'" class="rounded-circle img-fluid img_content">
                    </a>
                  </div>
                </td>
                <td><strong>{{leaves.name}}</strong></td>
                <td>{{leaves.leaveDuration}}</td>
                <td>
                  <span *ngIf="leaves.attechment && leaves.attechment.length">
                    <span *ngFor="let att of leaves.attechment;  let i =index">
                      <a *ngIf="!att.includes('.pdf') && leaves.attechment.length" [attr.data-lightbox]="leaves._id" class="image_attachment" href="{{path}}{{att}}" target="_blank"><span *ngIf="i == 0">View images</span></a>
                      <a *ngIf="att.includes('.pdf')" class="image_attachment" href="{{path}}{{att}}" target="_blank"><span>View Pdf</span></a>
                    </span>
                  </span>
                  <span  *ngIf="leaves.attechment && !leaves.attechment.length">
                    <a data-lightbox="comment_image"  class="image_attachment" href="{{path}}{{leaves.attechment}}">View Attechment</a>
                  </span>
                  <p *ngIf="!leaves.attechment" style="color: blue; font-size: 16px;">No Attechment</p>
                </td>
                <td>
                  <button type="button" class="btn btn-default waves-effect waves-light" data-toggle="modal" data-target="#centralModalInfo" (click)="leaveById(leaves._id)">Comment</button>
                </td>
                <td>
                  <button type="button" class="btn btn-default waves-effect waves-light" data-toggle="modal" data-target="#viewmore" (click)="leaveById(leaves._id)">ViewMore</button>
                </td>
                <td>
                  <strong *ngIf="leaves.status=='pending'" style="color: orange;text-transform: uppercase;">{{leaves.status}}</strong>
                  <strong *ngIf="leaves.status=='approved'" style="color: darkgreen;text-transform: uppercase;">{{leaves.status}}</strong>
                  <strong *ngIf="leaves.status=='rejected'" style="color: red;text-transform: uppercase;">{{leaves.status}}</strong>
                </td>
                <td *ngIf="leaves.status=='pending'"><a><i class="fa fa-check a_icon" aria-hidden="true" (click)="leaveAccepted(leaves._id)"></i><i class="fa fa-times r_icon" aria-hidden="true" (click)="leaveRejected(leaves._id)"></i></a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container">
 <div class="row" *ngIf="leavesToDisplay">
  <div class="col-sm-6">
    <h2>Type Of Leave</h2>
    <p *ngIf="leaveApp" style="margin-top: 35px;">{{leaveApp.length}} responses</p>
    <canvas id="pieChart"></canvas>
  </div>            
  <div class="col-sm-6">
    <h2>Duration</h2>
    <p *ngIf="leaveApp" style="margin-top: 35px;">{{leaveApp.length}} responses</p>
    <canvas id="pieChart1"></canvas>
  </div>
</div>
</div>




<!-- Comment Model -->

<div class="modal fade" id="centralModalInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-notify modal-info" role="document">
  <!--Content-->
  <div class="modal-content">
    <!--Header-->
    <div class="modal-header purple-gradient-2 ">
      <p class="heading lead">Leave Comment</p>
<!-- 
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" class="white-text">&times;</span>
        </button> -->
      </div>

      <!--Body-->
      <div class="modal-body">
        <p *ngIf="singleleave">Previous Comment:{{singleleave.comment}}</p>
        <form style="width: 100%;">
          <div class="text-center">
            <i class="fas fa-check fa-4x mb-3 animated rotateIn"></i>
            <div class="form-group" style="text-align: left">
              <label for="exampleFormControlTextarea3"><strong style="font-size: 24px;">Add Comment</strong></label>
              <textarea name="comment" [(ngModel)]="comment" class="form-control" id="exampleFormControlTextarea3" rows="7" ></textarea>
            </div>
          </div>
          <div class="modal-footer justify-content-center">
            <input type="submit" class="btn btn-default" (click)="submitComment(singleleave._id,comment)">
            <br>
            <a class="btn btn-outlinn-default waves-effect" data-dismiss="modal">Cancel</a>
          </div>
        </form>
      </div>

      <!--Footer-->
    </div>
    <!--/.Content-->
  </div>
</div>



<!-- Comment Model -->

<div class="modal fade" id="viewmore" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-notify modal-info" role="document">
  <!--Content-->
  <div class="modal-content" *ngIf="singleleave">
    <!--Header-->
    <div class="modal-header purple-gradient-2 ">
      <p class="heading lead text-center">Leave Details</p>
      <button type="button" class="close margin-right-10" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <!-- <p class="heading lead text-center">Modal Info</p>
      <button type="button" class="close margin-right-10" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button> -->

    </div>

    <!--Body-->
    <div class="modal-body">
      <div class="card padding-10 z-depth-5">
        <div class="container">
          <div class="row">
            <div class="col-md-6 border padding-top-5 ">
              <h6><i class="far fa-user"></i> Name:</h6>
              <p *ngIf="singleleave">{{singleleave.name}}</p>  
            </div>
            <div class="col-md-6 border padding-top-5 ">
             <h6><i class="far fa-envelope"></i> Email:</h6>
             <p *ngIf="singleleave">{{singleleave.email}}</p> 
           </div>
         </div>
         <div class="row">
          <div class="col-md-6 border padding-top-5 ">
            <h6><i class="far fa-calendar-alt"></i> StartingDate:</h6>
            <p *ngIf="singleleave">{{singleleave.startingDate | date:'mediumDate'}}</p>
          </div>
          <div class="col-md-6 border padding-top-5 ">
            <h6> <i class="fas fa-calendar-alt"></i> EndingDate:</h6>
            <p *ngIf="singleleave">{{singleleave.endingDate | date:'mediumDate'}}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 border padding-top-5 ">
            <h6><i class="far fa-clock"></i> LeaveDuration:</h6>
            <p *ngIf="singleleave">{{singleleave.leaveDuration}}</p>  
          </div>
          <div class="col-md-6 border padding-top-5 ">
            <h6><i class="far fa-dot-circle"></i> LeaveType:</h6>
            <p *ngIf="singleleave">{{singleleave.typeOfLeave}}</p>  
          </div>
        </div>
        <div class="row border">
          <div class="col-md-12 padding-top-5 ">
            <h6><i class="fas fa-pen-square"></i> LeaveReason:</h6>
            <p style="text-align: justify;" *ngIf="singleleave">{{singleleave.reasonForLeave}}</p>  
          </div>
       <!--  </div>
        <div class="footer_1"> -->
        </div> 
        <div class="leaveHeading">
          <div class="row">
            <div class="col-md-6 leaveCount">
              <h6>Total Leave: <span *ngFor="let leave of leavescount" style="color: black">{{leave.leavesPerYear}}</span></h6>
            </div>
            <div class="col-md-6 leaveCount">
              <h6>Available Leave: <span *ngFor="let leave of leavescount" style="color: black">{{leave.leavesLeft}}</span></h6>
            </div>
          </div>  
        </div> 
        <div class="row mb-2">
          <div class="col-md-6 border padding-top-5" *ngFor="let leave of leavescount | slice:0:4">
            <h6>{{leave.typeOfLeave}}:</h6>
            <p><span style="background-color: lightblue;color: black;text-shadow: 1px 1px;padding: 5px;">{{leave.leavesTaken}}</span></p>
          </div>
        </div>
        <a class="float-right"><i class="fa fa-check a_icon" aria-hidden="true" (click)="leaveAccepted(leaves._id)"></i>
          <i class="fa fa-times r_icon" aria-hidden="true" (click)="leaveRejected(leaves._id)"></i></a>
        </div>
      </div>
    </div>
  </div>
</div>
<!--/.Content-->
</div>